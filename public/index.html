<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AstraFX â€” Analyzer</title>
  <style>
    :root{--bg:#0b0f16;--panel:#0f1623;--soft:#141e2d;--ink:#e6edf3;--muted:#9fb0c7;--accent:#f97316;--green:#10b981;--red:#ef4444}
    *{box-sizing:border-box} html,body{height:100%} body{margin:0;background:radial-gradient(1200px 700px at 20% -10%,#122032,#0b0f16 40%),#0b0f16;color:var(--ink);font:15px/1.5 system-ui,Segoe UI,Roboto}
    .wrap{max-width:1280px;margin:0 auto;padding:18px}
    header{display:flex;align-items:center;gap:12px;margin:6px 0 14px}
    h1{margin:0;font-weight:900;letter-spacing:.3px}
    h1 .hi{font-size:32px}
    h1 .fx{font-size:32px;color:#8cc1ff}
    .pill{background:#0f1623;border:1px solid #22314a;color:#9fb0c7;border-radius:999px;padding:6px 10px;font-size:12px}
    .grid{display:grid;grid-template-columns:280px 1fr;gap:16px}
    .panel{background:rgba(15,22,35,.82);border:1px solid #22314a;border-radius:16px;padding:14px;backdrop-filter:blur(6px)}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    label{font-size:12px;color:#a8b3c3}
    select,input[type=number]{background:#0b1422;border:1px solid #233249;color:var(--ink);border-radius:10px;padding:10px}
    .btn{background:var(--accent);border:1px solid #cf5a0f;color:#111;padding:10px 12px;border-radius:12px;font-weight:800;cursor:pointer}
    .btn.ghost{background:#111;color:#e6edf3;border:1px solid #2a3548}
    .chips{display:flex;flex-wrap:wrap;gap:8px}
    .chip{background:#0b1422;border:1px solid #22314a;color:#cbd5e1;border-radius:999px;padding:6px 10px;font-weight:600;cursor:pointer}
    .chip.active{background:#20314a}
    .titlebar{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
    .cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(360px,1fr));gap:14px}
    .card{background:#0f1623;border:1px solid #22314a;border-radius:16px;padding:12px;display:flex;flex-direction:column;gap:10px}
    .badge{display:inline-block;padding:4px 10px;border-radius:999px;font-weight:800;font-size:12px}
    .badge.buy{background:var(--green);color:#111}
    .badge.sell{background:var(--red);color:#111}
    canvas,img{max-width:100%;border-radius:10px;background:#0b1422}
    .foot{display:flex;gap:10px;align-items:center;justify-content:flex-end}
    /* hide until js fills content */
    .hidden{display:none}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1><span class="hi">Daily High-Probability</span> <span class="fx">FX Setups</span></h1>
      <span class="pill">Live chart scans on demand</span>
      <div style="flex:1"></div>
      <a class="pill" href="/" title="Back to landing">Home</a>
    </header>

    <div class="grid">
      <!-- LEFT CONTROLS -->
      <aside class="panel" id="controls">
        <div class="row" style="justify-content:space-between">
          <div class="row">
            <label style="margin-right:6px">Account balance</label>
            <input id="accountBalance" type="number" step="50" min="0" value="10000" style="width:110px">
          </div>
          <div class="row">
            <label style="margin-right:6px">Risk %</label>
            <input id="riskPct" type="number" step="0.1" min="0" value="1.0" style="width:70px">
          </div>
        </div>

        <div style="height:10px"></div>

        <div class="row">
          <label>Timeframe</label>
          <div class="chips" id="timeframes">
            <!-- name=tf so your scripts can pick it up -->
            <label class="chip"><input type="radio" name="tf" value="M1"  class="hidden">M1</label>
            <label class="chip"><input type="radio" name="tf" value="M5"  class="hidden">M5</label>
            <label class="chip"><input type="radio" name="tf" value="M15" class="hidden" checked>M15</label>
            <label class="chip"><input type="radio" name="tf" value="M30" class="hidden">M30</label>
            <label class="chip"><input type="radio" name="tf" value="H1"  class="hidden">H1</label>
            <label class="chip"><input type="radio" name="tf" value="H4"  class="hidden">H4</label>
            <label class="chip"><input type="radio" name="tf" value="D1"  class="hidden">D1</label>
          </div>
        </div>

        <div style="height:10px"></div>

        <div class="row" style="gap:12px">
          <div style="flex:1">
            <label>Strategy</label>
            <select id="strategy">
              <option value="all" selected>All</option>
              <option value="engulfing">Engulfing</option>
              <option value="breakout">Breakout</option>
              <option value="pullback">Pullback</option>
              <option value="retest">Retest</option>
            </select>
          </div>
          <div style="flex:1">
            <label>Pattern</label>
            <select id="pattern">
              <option value="any" selected>Any</option>
              <option value="doubletop">Double Top</option>
              <option value="doublebottom">Double Bottom</option>
              <option value="headshoulders">Head &amp; Shoulders</option>
              <option value="triangle">Triangle</option>
            </select>
          </div>
        </div>

        <div style="height:10px"></div>

        <div class="row">
          <label>Watchlist</label>
          <div class="chips" id="watchlist">
            <button class="chip" data-pair="EURUSD">EURUSD</button>
            <button class="chip" data-pair="GBPUSD">GBPUSD</button>
            <button class="chip" data-pair="USDJPY">USDJPY</button>
            <button class="chip" data-pair="XAUUSD">XAUUSD</button>
            <button class="chip" data-pair="USDCAD">USDCAD</button>
            <button class="chip" data-pair="AUDUSD">AUDUSD</button>
            <button class="chip" data-pair="NZDUSD">NZDUSD</button>
          </div>
        </div>

        <div style="height:10px"></div>

        <div class="row" style="align-items:center">
          <label style="margin-right:8px">Filters â€” Min Score:</label>
          <input id="scoreMin" type="range" min="0" max="100" step="5" value="20" style="flex:1">
          <span id="scoreMinVal" class="pill">20</span>
        </div>

        <div style="height:12px"></div>

        <div class="row">
          <button id="analyzeBtn" class="btn">âš¡ Analyze Now</button>
          <button id="saveAllBtn" class="btn ghost">ðŸ’¾ Save All Charts</button>
          <button id="settingsBtn" class="btn ghost">Contract Settings</button>
        </div>
      </aside>

      <!-- RIGHT: RESULTS -->
      <main class="panel">
        <div class="titlebar">
          <div class="row"><span class="pill">Results</span></div>
          <div class="row" id="summary"></div>
        </div>

        <div id="cards" class="cards"></div>

        <!-- Template used by JS if needed -->
        <template id="cardTpl">
          <article class="card">
            <div class="row" style="justify-content:space-between">
              <div class="row" style="gap:10px">
                <span class="pill pair">EURUSD</span>
                <span class="pill tf">M30</span>
              </div>
              <span class="badge score">85</span>
            </div>
            <div class="chart"><img alt="chart preview"/></div>
            <div class="row" style="gap:14px;flex-wrap:wrap">
              <div><label>Entry</label> <div class="entry">â€”</div></div>
              <div><label>SL</label> <div class="sl">â€”</div></div>
              <div><label>TP1</label> <div class="tp1">â€”</div></div>
              <div><label>Side</label> <span class="badge side buy">BUY</span></div>
            </div>
            <div class="foot">
              <button class="btn ghost placeBtn">Place Trade</button>
            </div>
          </article>
        </template>
      </main>
    </div>
  </div>

  <!-- Compatibility shim so older code finds elements even if it expects other IDs -->
  <script>
    // mirror common IDs some older scripts might look for
    document.getElementById('scanBtn')     || (function(){ let x=document.getElementById('analyzeBtn'); x.id='analyzeBtn'; })();
    document.getElementById('cardsGrid')   || (function(){ let x=document.getElementById('cards'); x.id='cards'; })();
    document.getElementById('strategySel') || (function(){ let x=document.getElementById('strategy'); x.id='strategy'; })();
    document.getElementById('patternSel')  || (function(){ let x=document.getElementById('pattern'); x.id='pattern'; })();
  </script>

  <!-- Your existing logic -->
  <script src="./oanda-candles.js" defer></script>
  <script src="./ohlc.js" defer></script>
  <script src="./signals.js" defer></script>
  <script src="./scan.js" defer></script>
</body>
</html>
<button id="logoutBtn" style="margin-left:8px">Logout</button>
<script>
  document.getElementById('logoutBtn')?.addEventListener('click', async ()=>{
    await fetch('/auth/logout', {method:'POST', credentials:'include'});
    location.href = '/';
  });
</script>
