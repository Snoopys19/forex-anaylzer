<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AstraFX — Sign in</title>
  <style>
    :root { --bg:#0b0f16; --card:#0f1623; --accent:#f97316; --text:#e6edf3; --muted:#98a2b3; }
    *{box-sizing:border-box} body{margin:0;font:16px/1.5 system-ui,Segoe UI,Roboto;background:var(--bg);color:var(--text)}
    .wrap{max-width:1080px;margin:0 auto;padding:32px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:24px}
    h1{margin:0;font-weight:800;letter-spacing:.5px}
    .pill{background:#101826;border:1px solid #1e293b;border-radius:999px;padding:6px 10px;color:var(--muted);font-size:12px}
    .grid{display:grid;grid-template-columns: 1.3fr .9fr; gap:24px}
    .card{background:var(--card);border:1px solid #1f2a3a;border-radius:16px;padding:18px;box-shadow:0 6px 20px rgba(0,0,0,.25)}
    .video{aspect-ratio:16/9;background:#0c1320;border:1px dashed #213146;border-radius:12px;display:grid;place-items:center;color:var(--muted)}
    label{display:block;margin:12px 0 6px;color:var(--muted);font-size:13px}
    input{width:100%;padding:12px;border-radius:10px;border:1px solid #233249;background:#0b1422;color:var(--text)}
    .row{display:flex;gap:10px}
    .btn{background:var(--accent);border:1px solid #cf5a0f;color:#111;padding:12px 14px;border-radius:12px;font-weight:700;cursor:pointer}
    .btn.secondary{background:#111;color:#e6edf3;border:1px solid #2a3548}
    .muted{color:var(--muted);font-size:13px;margin-top:8px}
    .err{color:#ef4444;font-size:13px;margin-top:8px;display:none}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div style="display:flex;align-items:center;gap:10px">
        <h1>AstraFX</h1><span class="pill">Analyzer</span>
      </div>
      <div class="pill">Secure Login Required</div>
    </header>

    <div class="grid">
      <section class="card">
        <h2 style="margin:4px 0 12px">Intro Video (Coming Soon)</h2>
        <div class="video">Video placeholder — add your embed later</div>
        <p class="muted">This is a placeholder — we’ll drop your YouTube/Vimeo/MP4 embed here later.</p>
      </section>

      <aside class="card">
        <h3 style="margin:0 0 12px">Sign in to continue</h3>
        <form id="authForm">
          <label>Email</label>
          <input id="email" type="email" placeholder="you@example.com" required />
          <label>Password</label>
          <input id="password" type="password" placeholder="••••••••" required />
          <div class="row" style="margin-top:12px">
            <button class="btn" type="submit">Log in</button>
            <button class="btn secondary" type="button" id="signupBtn">Create account</button>
          </div>
          <div id="msg" class="err"></div>
          <div class="muted">Your session is secured with an HttpOnly cookie.</div>
        </form>
      </aside>
    </div>
  </div>

  <script>
    async function post(url, body){
      const r = await fetch(url, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify(body),
        credentials: 'include'
      });
      const j = await r.json().catch(()=>({}));
      if(!r.ok) throw new Error(j.detail || j.error || r.statusText);
      return j;
    }
    async function checkMe(){
      const r = await fetch('/auth/me', {credentials:'include'});
      if(r.ok){ location.href = '/app'; }
    }
    checkMe().catch(()=>{});
    const form = document.getElementById('authForm');
    const msg  = document.getElementById('msg');
    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      msg.style.display='none';
      try{
        await post('/auth/login', { email: email.value.trim(), password: password.value });
        location.href = '/app';
      }catch(err){
        msg.textContent = err.message || 'Login failed';
        msg.style.display='block';
      }
    });
    document.getElementById('signupBtn').addEventListener('click', async ()=>{
      msg.style.display='none';
      try{
        await post('/auth/signup', { email: email.value.trim(), password: password.value });
        await post('/auth/login',  { email: email.value.trim(), password: password.value });
        location.href = '/app';
      }catch(err){
        msg.textContent = err.message || 'Signup failed';
        msg.style.display='block';
      }
    });
  </script>
</body>
</html>
